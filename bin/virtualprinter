#!/usr/bin/env node
// Debug stuff like this
// npm install -g simple-stacktrace watchy
// watchy -w . -- bash -c "cat some-payload.bin | bin/virtualprinter 2>&1 | simple-stacktrace"
var VirtualPrinter = require('../src');

var vp = new VirtualPrinter();

var $ = require('cheerio')
window = { $: $ }

var fs = require('fs');
var outfile = __dirname+'/../output.html'

process.stdin.on('data', function(buf) {
  vp.generateHTMLFromByteArray(buf, function(result) {
    result.find('>span').each(function(i, span) {
      console.log($(span).text());
    });
    fs.writeFile(outfile, result.html(), function(err) {
      if (err) throw err;
      console.log('wrote html '+outfile);
    });
  });
});
